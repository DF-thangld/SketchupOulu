{% extends "base.html" %}
{% block custom_css %}

{% endblock %}

{% block onload_script %}
    get_user_building_models();
    $(document).on('click', '.well a', function()
    {
	   $(".well a").removeClass("active");
	   $(this).addClass("active");
	});
    $('#new_comment').autoHeight();
{% endblock %}

{% block js_script %}

    function get_user_building_models()
    {
        $('#search_results').html('');

        var post_data = {
            'filter_text': $('#filter_text').val(),
        };
        $.ajax({
            type: "POST",
            url: "{{ url_for('users.get_user_building_models', username=user.username) }}",
            data: post_data,
            dataType: 'json',
            success: function(data) {
                $('#search_results').html('');
                for (i = 0; i < data.building_models.length; i++)
                {
                    var building_model = data.building_models[i];
                    $('#search_results').append('<a id="building_model_' + building_model.id + '" class="list-group-item" href="javascript:fetch_building_model(\'' + building_model.id + '\');">' + building_model.name + '</a>');
                }

                if ($('#building_model_id').val() == '')
                {
                    if (data.building_models.length > 0)
                        fetch_building_model(data.building_models[0].id);
                    else
                    {
                        $('#no_building_model_label').html('User has no building model');
                        $('#no_building_model_block').fadeIn('fast');
                    }
                }
            }
        });
    }

    function fetch_building_model(building_model_id)
    {

        $(".well a").removeClass("active");
	    $('#building_model_'+building_model_id).addClass("active");

        $.ajax({
            type: "GET",
            url: "{{ url_for('sketchup.get_building_model') }}?id=" + building_model_id,
            dataType: 'json',
            success: function(data)
            {

                $('#building_model_id').val(data.id);
                $('#building_model_name').html('<a href="{{ url_for('sketchup.view_building_model') }}?id=' + data.id + '">' + data.name + '</a>');
                $('#profile_picture').attr('src', '{{ url_for('static', filename='images/profile_pictures') }}/' + data.owner.profile_picture);
                $('#created_user').html(data.owner.username);
                $('#created_time').html(Date.parse(data.created_time).toString('dd.MM.yyyy hh:mm:ss'));
                $('#object_id').val(data.id);

                $('#comment_list').html('');
                for (i=0; i < data.comments.length; i++)
                {
                    comment = data.comments[i];
                    var new_comment_html = '';
                    new_comment_html += '<li><div class="commenterImage"><img style="max-width:50px;max-height:50px;" src="{{ url_for('static', filename='images/profile_pictures') }}/' + comment.owner.profile_picture + '" /></div>';
                    new_comment_html += '<div class="commentText"><p class="">' + comment.content + '</p> <span class="date sub-text">By <a href="{{ request.url_root }}users/' + comment.owner.username + '/profile">' + comment.owner.username + '</a> on ' + Date.parse(comment.created_time).toString('dd.MM.yyyy hh:mm:ss') + '</span></div></li>';
                    $('#comment_list').append(new_comment_html);
                }
                $('#no_building_model_block').fadeOut('fast');
                $('#user_data_form').fadeIn('fast');

            }
        });
    }



{% endblock %}

{% block menu %}
	{% include 'inside_menu.html' %}
{% endblock %}

{% block main_content %}
<div class="">
	<div class="row" style="margin-top: 20px;">
        <div class="col-md-10 col-centered">
            <ol class = "breadcrumb">
               <li><a href = "{{ url_for('index') }}">Home</a></li>
               <li class = "active"><a href="{{ url_for('users.profile', username=user.username) }}">{{ user.username }}</a></li>
               <li class = "active"><a href="{{ url_for('users.user_building_models_page', username=user.username) }}">Building models</a></li>
            </ol>
            <h2 style="font-size: 45px;">{{ user.username }}'s building models</h2>

            <div class="col-md-4">
                <div class="row" style="margin-bottom:10px;">
                    <div class="col-md-12">
                        <a type="button" style="width:100%; margin-bottom:10px;" class="btn btn-primary" href="{{ url_for('users.add_building_model') }}">
                            <span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span> Add building model
                        </a>
                        <form id="building_model_search_form" method="POST" action="{{ url_for('users.get_user_building_models', username=user.username) }}">
                            <input class="form-control input-lg" id="filter_text" name="filter_text" name="user_info" onkeyup="get_user_building_models();" placeholder="Search by name" type="text" value="">
                        </form>
                    </div>
                </div>
                <!-- Search result area -->
                <div class="row">
                    <div class="col-lg-12">
                        <div class="well">
                            <div class="list-group auto_list" id="search_results">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-8" id="no_building_model_block">
                <h3 id="no_building_model_label"></h3>
            </div>
            <div class="col-md-8" id="user_data_form" style="display:none">
                <h3><span id="building_model_name" style="font-weight: bold"></span></h3>
                <div style="float:left;">
                    <img id="profile_picture" src="{{ url_for('static', filename='images/profile_pictures/default_profile.png') }}" style="width:60px;"/>
                </div>
                <div style="float:left; margin-left:10px;">
                    <div>Created by <span id="created_user"></span> at <span id="created_time"></span></div>
                </div>
                <div style="clear:both;margin-bottom:10px;"></div>

                <div id="building_model_content">
                    <input type="hidden" id="building_model_id" value="" />

                    <div style="width:100%;height:500px;border:1px solid black;">
                        Frame for model
                    </div>
                </div>
                <div id="building_model_comment_panel" style="margin-top:10px;">
                    <div class="detailBox">
                        <div class="titleBox">
                          <label>Comment Box</label>
                        </div>
                        <div class="commentBox">
                            <input type="hidden" id="comment_type" value="building_model" />
                            <input type="hidden" id="object_id" value="" />
                            <textarea id="new_comment" style="width:100%" class="form-control form-group" type="text" placeholder="Your comments" ></textarea>
                            <div class="form-group">
                                <button class="btn btn-default" onclick="add_comment();">Add</button>
                            </div>
                        </div>
                        <div class="actionBox">
                            <ul class="commentList" id="comment_list">

                            </ul>

                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>


{% endblock %}